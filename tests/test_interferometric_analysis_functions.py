# SPDX-FileCopyrightText: Aresys S.r.l. <info@aresys.it>
# SPDX-License-Identifier: MIT

"""Unittest for interferometric_analysis core functionalities"""

import unittest
from pathlib import Path
from tempfile import TemporaryDirectory

import numpy as np
from netCDF4 import Dataset

from arepyextras.quality.core.generic_dataclasses import SARPolarization
from arepyextras.quality.interferometric_analysis.config import InterferometricConfig
from arepyextras.quality.interferometric_analysis.custom_dataclasses import (
    InterferometricCoherence2DHistograms,
    InterferometricCoherenceOutput,
)
from arepyextras.quality.interferometric_analysis.support import (
    coherence_2d_histogram_computation_core,
    coherence_computation_co_registered_core,
    coherence_computation_interferogram_core,
    coherence_histograms_to_netcdf,
)


class TestInterferometricAnalysisFunctions(unittest.TestCase):
    """Testing Interferometric Analysis support functionalities"""

    def setUp(self) -> None:
        """Testing setup"""
        self._test_array_re = np.array(
            [
                [
                    0.3966,
                    0.7596,
                    0.2432,
                    0.6916,
                    0.4279,
                    0.9687,
                    0.8592,
                    0.9459,
                    0.5814,
                    0.7547,
                    0.2553,
                    0.7077,
                    0.1202,
                    0.2924,
                    0.674,
                    0.8722,
                    0.182,
                    0.2684,
                    0.094,
                    0.0162,
                ],
                [
                    0.275,
                    0.4509,
                    0.0452,
                    0.1443,
                    0.6838,
                    0.8631,
                    0.0409,
                    0.7619,
                    0.3074,
                    0.4137,
                    0.957,
                    0.3557,
                    0.197,
                    0.8312,
                    0.2178,
                    0.6234,
                    0.6054,
                    0.1602,
                    0.7927,
                    0.6427,
                ],
                [
                    0.0951,
                    0.7397,
                    0.3692,
                    0.3436,
                    0.745,
                    0.0387,
                    0.7767,
                    0.5809,
                    0.7116,
                    0.7691,
                    0.8606,
                    0.8559,
                    0.2828,
                    0.5561,
                    0.5286,
                    0.7277,
                    0.819,
                    0.3706,
                    0.5525,
                    0.6103,
                ],
                [
                    0.1404,
                    0.8941,
                    0.5689,
                    0.1291,
                    0.2436,
                    0.0332,
                    0.2962,
                    0.1518,
                    0.815,
                    0.7591,
                    0.2705,
                    0.5574,
                    0.2646,
                    0.0204,
                    0.3802,
                    0.6709,
                    0.587,
                    0.5613,
                    0.4259,
                    0.7847,
                ],
                [
                    0.9557,
                    0.0793,
                    0.1144,
                    0.7099,
                    0.7753,
                    0.4933,
                    0.1335,
                    0.3341,
                    0.4695,
                    0.6554,
                    0.3631,
                    0.5081,
                    0.7396,
                    0.6888,
                    0.2596,
                    0.206,
                    0.5742,
                    0.8539,
                    0.9671,
                    0.1201,
                ],
                [
                    0.7348,
                    0.2613,
                    0.2637,
                    0.5312,
                    0.9326,
                    0.2915,
                    0.1232,
                    0.3207,
                    0.3098,
                    0.8909,
                    0.6653,
                    0.7242,
                    0.4342,
                    0.5561,
                    0.7459,
                    0.0392,
                    0.8431,
                    0.7212,
                    0.0433,
                    0.6969,
                ],
                [
                    0.3611,
                    0.0747,
                    0.7072,
                    0.6946,
                    0.623,
                    0.3127,
                    0.1267,
                    0.204,
                    0.4057,
                    0.2843,
                    0.387,
                    0.3136,
                    0.9246,
                    0.4976,
                    0.8738,
                    0.1063,
                    0.7947,
                    0.7805,
                    0.6448,
                    0.4396,
                ],
                [
                    0.9025,
                    0.7039,
                    0.4597,
                    0.8953,
                    0.995,
                    0.6682,
                    0.3376,
                    0.1287,
                    0.3164,
                    0.9369,
                    0.5679,
                    0.3245,
                    0.8321,
                    0.4197,
                    0.6968,
                    0.9932,
                    0.6651,
                    0.7296,
                    0.2837,
                    0.851,
                ],
                [
                    0.3699,
                    0.706,
                    0.0611,
                    0.4277,
                    0.724,
                    0.2315,
                    0.5425,
                    0.5839,
                    0.6756,
                    0.5644,
                    0.4467,
                    0.3226,
                    0.5432,
                    0.1043,
                    0.2714,
                    0.8913,
                    0.1177,
                    0.4868,
                    0.8883,
                    0.8057,
                ],
                [
                    0.2563,
                    0.4311,
                    0.3117,
                    0.2401,
                    0.3208,
                    0.8954,
                    0.8408,
                    0.5558,
                    0.5645,
                    0.4557,
                    0.6984,
                    0.8023,
                    0.4442,
                    0.7735,
                    0.9538,
                    0.6744,
                    0.7569,
                    0.0891,
                    0.2512,
                    0.3239,
                ],
                [
                    0.3772,
                    0.7568,
                    0.1736,
                    0.2446,
                    0.4761,
                    0.8331,
                    0.4558,
                    0.7826,
                    0.3348,
                    0.4036,
                    0.4797,
                    0.1655,
                    0.3357,
                    0.3348,
                    0.5781,
                    0.137,
                    0.7641,
                    0.7528,
                    0.683,
                    0.3062,
                ],
                [
                    0.8561,
                    0.341,
                    0.3349,
                    0.173,
                    0.0449,
                    0.649,
                    0.4714,
                    0.2301,
                    0.3726,
                    0.4437,
                    0.2582,
                    0.2516,
                    0.0808,
                    0.1916,
                    0.0087,
                    0.3696,
                    0.1663,
                    0.5027,
                    0.9424,
                    0.4776,
                ],
                [
                    0.4035,
                    0.9087,
                    0.5643,
                    0.5557,
                    0.2597,
                    0.8662,
                    0.996,
                    0.0783,
                    0.3377,
                    0.851,
                    0.1735,
                    0.7331,
                    0.7255,
                    0.6396,
                    0.335,
                    0.6547,
                    0.6247,
                    0.7256,
                    0.4007,
                    0.6332,
                ],
                [
                    0.0177,
                    0.0678,
                    0.1955,
                    0.0714,
                    0.4784,
                    0.7098,
                    0.0111,
                    0.5663,
                    0.7981,
                    0.488,
                    0.7111,
                    0.8557,
                    0.4154,
                    0.0692,
                    0.2148,
                    0.0274,
                    0.2674,
                    0.8403,
                    0.6312,
                    0.7754,
                ],
                [
                    0.7964,
                    0.6622,
                    0.3018,
                    0.4078,
                    0.3156,
                    0.1942,
                    0.7067,
                    0.1258,
                    0.7313,
                    0.6355,
                    0.8842,
                    0.3874,
                    0.8507,
                    0.8025,
                    0.4943,
                    0.6826,
                    0.3726,
                    0.0273,
                    0.5852,
                    0.3029,
                ],
                [
                    0.7683,
                    0.0086,
                    0.114,
                    0.272,
                    0.423,
                    0.7402,
                    0.9094,
                    0.4534,
                    0.8229,
                    0.6564,
                    0.1309,
                    0.1402,
                    0.2807,
                    0.8957,
                    0.0052,
                    0.0024,
                    0.854,
                    0.7587,
                    0.8487,
                    0.7025,
                ],
                [
                    0.8065,
                    0.096,
                    0.5781,
                    0.3557,
                    0.5352,
                    0.3138,
                    0.2168,
                    0.1832,
                    0.1114,
                    0.3792,
                    0.8301,
                    0.5756,
                    0.298,
                    0.9069,
                    0.3662,
                    0.4468,
                    0.7856,
                    0.4125,
                    0.2549,
                    0.4021,
                ],
                [
                    0.5487,
                    0.9139,
                    0.7565,
                    0.8962,
                    0.5099,
                    0.4736,
                    0.4083,
                    0.1681,
                    0.8215,
                    0.097,
                    0.2898,
                    0.223,
                    0.5645,
                    0.6037,
                    0.2698,
                    0.1788,
                    0.2358,
                    0.3336,
                    0.3892,
                    0.7861,
                ],
                [
                    0.9062,
                    0.654,
                    0.0553,
                    0.4636,
                    0.4689,
                    0.892,
                    0.321,
                    0.7187,
                    0.7889,
                    0.5122,
                    0.4919,
                    0.1199,
                    0.0617,
                    0.9721,
                    0.5636,
                    0.2671,
                    0.8035,
                    0.0547,
                    0.9434,
                    0.17,
                ],
                [
                    0.9856,
                    0.294,
                    0.9085,
                    0.0418,
                    0.1454,
                    0.0382,
                    0.2866,
                    0.7545,
                    0.1547,
                    0.1323,
                    0.7117,
                    0.5608,
                    0.0587,
                    0.2848,
                    0.7556,
                    0.5474,
                    0.9435,
                    0.7716,
                    0.7406,
                    0.8103,
                ],
            ]
        )
        self._test_array_im = np.array(
            [
                [
                    0.7371,
                    0.5933,
                    0.0626,
                    0.974,
                    0.0269,
                    0.1392,
                    0.0683,
                    0.6204,
                    0.4825,
                    0.9348,
                    0.6237,
                    0.5636,
                    0.0227,
                    0.9538,
                    0.4533,
                    0.2658,
                    0.5,
                    0.946,
                    0.7558,
                    0.1039,
                ],
                [
                    0.553,
                    0.4252,
                    0.1577,
                    0.6674,
                    0.1609,
                    0.7032,
                    0.6075,
                    0.2326,
                    0.0668,
                    0.6123,
                    0.6031,
                    0.3191,
                    0.2577,
                    0.7463,
                    0.559,
                    0.4506,
                    0.4512,
                    0.924,
                    0.0145,
                    0.8881,
                ],
                [
                    0.4362,
                    0.0325,
                    0.7023,
                    0.1602,
                    0.4789,
                    0.427,
                    0.9315,
                    0.6862,
                    0.8898,
                    0.8753,
                    0.6777,
                    0.9032,
                    0.1992,
                    0.7844,
                    0.6485,
                    0.9415,
                    0.6614,
                    0.6961,
                    0.5281,
                    0.6562,
                ],
                [
                    0.5672,
                    0.1792,
                    0.128,
                    0.5428,
                    0.5639,
                    0.8226,
                    0.7895,
                    0.7825,
                    0.6517,
                    0.3482,
                    0.0026,
                    0.8896,
                    0.7176,
                    0.9303,
                    0.7102,
                    0.0103,
                    0.1174,
                    0.1795,
                    0.3441,
                    0.4985,
                ],
                [
                    0.2346,
                    0.9967,
                    0.0287,
                    0.4329,
                    0.3938,
                    0.7545,
                    0.4504,
                    0.0994,
                    0.3417,
                    0.6808,
                    0.862,
                    0.8928,
                    0.2642,
                    0.8902,
                    0.9231,
                    0.4597,
                    0.4281,
                    0.3826,
                    0.6669,
                    0.9799,
                ],
                [
                    0.7063,
                    0.5121,
                    0.2952,
                    0.9414,
                    0.6144,
                    0.854,
                    0.551,
                    0.2697,
                    0.8,
                    0.9739,
                    0.362,
                    0.7833,
                    0.3797,
                    0.8005,
                    0.1988,
                    0.7236,
                    0.9197,
                    0.3287,
                    0.0372,
                    0.9399,
                ],
                [
                    0.5616,
                    0.2404,
                    0.0418,
                    0.3446,
                    0.5681,
                    0.5152,
                    0.3151,
                    0.6152,
                    0.7717,
                    0.4046,
                    0.7253,
                    0.9391,
                    0.0986,
                    0.2108,
                    0.6369,
                    0.7255,
                    0.8767,
                    0.3167,
                    0.8205,
                    0.9827,
                ],
                [
                    0.1408,
                    0.9404,
                    0.8744,
                    0.3048,
                    0.6146,
                    0.6157,
                    0.123,
                    0.3741,
                    0.3393,
                    0.7803,
                    0.9629,
                    0.0503,
                    0.8309,
                    0.5992,
                    0.7384,
                    0.7134,
                    0.7801,
                    0.7392,
                    0.4082,
                    0.9227,
                ],
                [
                    0.2786,
                    0.8452,
                    0.6108,
                    0.0748,
                    0.5482,
                    0.151,
                    0.8162,
                    0.6614,
                    0.6982,
                    0.9055,
                    0.931,
                    0.7577,
                    0.9169,
                    0.9627,
                    0.8339,
                    0.083,
                    0.238,
                    0.7959,
                    0.2995,
                    0.7092,
                ],
                [
                    0.3669,
                    0.6164,
                    0.9963,
                    0.7959,
                    0.3749,
                    0.0592,
                    0.6941,
                    0.4884,
                    0.9466,
                    0.7915,
                    0.6134,
                    0.5762,
                    0.679,
                    0.6273,
                    0.2226,
                    0.8394,
                    0.3068,
                    0.1842,
                    0.3569,
                    0.5586,
                ],
                [
                    0.3898,
                    0.0764,
                    0.5828,
                    0.7443,
                    0.9127,
                    0.0223,
                    0.2954,
                    0.2093,
                    0.4568,
                    0.1312,
                    0.4335,
                    0.6577,
                    0.1855,
                    0.7703,
                    0.0691,
                    0.4722,
                    0.6312,
                    0.9124,
                    0.3551,
                    0.0644,
                ],
                [
                    0.8131,
                    0.8791,
                    0.4379,
                    0.8008,
                    0.9009,
                    0.1278,
                    0.8809,
                    0.01,
                    0.4015,
                    0.4325,
                    0.7832,
                    0.9016,
                    0.9427,
                    0.6555,
                    0.9082,
                    0.8002,
                    0.0799,
                    0.8599,
                    0.3221,
                    0.5044,
                ],
                [
                    0.0773,
                    0.7105,
                    0.5761,
                    0.5799,
                    0.6789,
                    0.4705,
                    0.1975,
                    0.3516,
                    0.2701,
                    0.2118,
                    0.1307,
                    0.2762,
                    0.3209,
                    0.7092,
                    0.9114,
                    0.2461,
                    0.5681,
                    0.7262,
                    0.253,
                    0.4881,
                ],
                [
                    0.8953,
                    0.7469,
                    0.3782,
                    0.4489,
                    0.3866,
                    0.4521,
                    0.8102,
                    0.2006,
                    0.5724,
                    0.3732,
                    0.6698,
                    0.5695,
                    0.0154,
                    0.7861,
                    0.5729,
                    0.4259,
                    0.0506,
                    0.0597,
                    0.8644,
                    0.5896,
                ],
                [
                    0.4356,
                    0.8774,
                    0.4472,
                    0.0229,
                    0.671,
                    0.5206,
                    0.6357,
                    0.5229,
                    0.1999,
                    0.4043,
                    0.7641,
                    0.5539,
                    0.6634,
                    0.7977,
                    0.776,
                    0.2867,
                    0.3189,
                    0.3121,
                    0.393,
                    0.7331,
                ],
                [
                    0.8701,
                    0.1197,
                    0.2982,
                    0.6723,
                    0.5359,
                    0.7854,
                    0.5918,
                    0.8946,
                    0.7626,
                    0.4491,
                    0.441,
                    0.2047,
                    0.8111,
                    0.9526,
                    0.8991,
                    0.5676,
                    0.8749,
                    0.0442,
                    0.3182,
                    0.0602,
                ],
                [
                    0.5206,
                    0.0761,
                    0.535,
                    0.1293,
                    0.8881,
                    0.8299,
                    0.3862,
                    0.6597,
                    0.6611,
                    0.583,
                    0.885,
                    0.6553,
                    0.4305,
                    0.3718,
                    0.2005,
                    0.0345,
                    0.2632,
                    0.6013,
                    0.7401,
                    0.0019,
                ],
                [
                    0.9513,
                    0.9141,
                    0.6379,
                    0.9698,
                    0.0536,
                    0.2492,
                    0.099,
                    0.7341,
                    0.8959,
                    0.956,
                    0.6207,
                    0.4103,
                    0.1201,
                    0.1935,
                    0.368,
                    0.2284,
                    0.9751,
                    0.2104,
                    0.0388,
                    0.1564,
                ],
                [
                    0.0308,
                    0.0287,
                    0.1269,
                    0.7828,
                    0.6906,
                    0.0752,
                    0.5137,
                    0.5552,
                    0.8343,
                    0.549,
                    0.9634,
                    0.9421,
                    0.6685,
                    0.7351,
                    0.7616,
                    0.986,
                    0.5797,
                    0.1665,
                    0.4133,
                    0.5849,
                ],
                [
                    0.2959,
                    0.2196,
                    0.7286,
                    0.9289,
                    0.6196,
                    0.3857,
                    0.9732,
                    0.7078,
                    0.9771,
                    0.9409,
                    0.4618,
                    0.5882,
                    0.3983,
                    0.5151,
                    0.618,
                    0.2966,
                    0.427,
                    0.8292,
                    0.7276,
                    0.156,
                ],
            ]
        )
        self._kernel_size = 8
        # expected results
        self._tolerance = 1e-6
        self._coherence = np.array(
            [
                0.6087167 + 0.66993212j,
                0.64719964 + 0.62887204j,
                0.63121965 + 0.62820172j,
                0.6184499 + 0.63734102j,
                0.62694573 + 0.63785247j,
                0.66934961 + 0.60926945j,
                0.644497 + 0.65384073j,
                0.65316248 + 0.65211705j,
                0.67542878 + 0.64360748j,
                0.65586474 + 0.66881043j,
                0.63200926 + 0.70168228j,
                0.63681054 + 0.71331348j,
                0.65612008 + 0.69060612j,
                0.65551559 + 0.68505891j,
                0.61925352 + 0.70148133j,
                0.60764265 + 0.6994434j,
                0.60648372 + 0.69637524j,
                0.61000102 + 0.69142071j,
                0.64972981 + 0.65700794j,
                0.66146537 + 0.63376793j,
                0.61427607 + 0.64940212j,
                0.65754156 + 0.61068425j,
                0.63876016 + 0.62277021j,
                0.62090749 + 0.63709718j,
                0.63153756 + 0.63330798j,
                0.65853444 + 0.62218853j,
                0.6585467 + 0.64953378j,
                0.6560291 + 0.65770369j,
                0.66421708 + 0.6605654j,
                0.64856272 + 0.67932274j,
                0.630873 + 0.70528317j,
                0.62915053 + 0.71847274j,
                0.63760664 + 0.70801597j,
                0.6375095 + 0.70352472j,
                0.61509266 + 0.70770651j,
                0.62024971 + 0.69485375j,
                0.60807845 + 0.69604186j,
                0.60191478 + 0.70185237j,
                0.63108965 + 0.67257044j,
                0.65472846 + 0.64281284j,
                0.60843657 + 0.67761494j,
                0.65611091 + 0.63512682j,
                0.62970838 + 0.65164193j,
                0.6087502 + 0.66553431j,
                0.62078817 + 0.65891678j,
                0.63415332 + 0.65507088j,
                0.63888396 + 0.67614964j,
                0.64226997 + 0.67683361j,
                0.65441544 + 0.67500436j,
                0.63733008 + 0.69441672j,
                0.62834949 + 0.71311801j,
                0.63931307 + 0.71148091j,
                0.63437599 + 0.70876914j,
                0.64137577 + 0.7012274j,
                0.62728666 + 0.69759712j,
                0.62686964 + 0.69107377j,
                0.61441737 + 0.69424908j,
                0.60740554 + 0.69957788j,
                0.6339779 + 0.67061599j,
                0.64346963 + 0.6587807j,
                0.62847336 + 0.65412599j,
                0.66977578 + 0.62250678j,
                0.64138052 + 0.64374477j,
                0.61879873 + 0.65976941j,
                0.62332984 + 0.65929181j,
                0.63295855 + 0.6577987j,
                0.63846701 + 0.67623824j,
                0.63266148 + 0.69043521j,
                0.63227017 + 0.69825089j,
                0.62211213 + 0.70407693j,
                0.61952944 + 0.71446683j,
                0.63525664 + 0.70853697j,
                0.62777932 + 0.70729893j,
                0.63790986 + 0.69840102j,
                0.63183035 + 0.68810788j,
                0.63413436 + 0.6812227j,
                0.62539582 + 0.68341025j,
                0.61196844 + 0.70011239j,
                0.62997721 + 0.68103963j,
                0.63052723 + 0.67638061j,
                0.64753852 + 0.63785343j,
                0.68609065 + 0.61037295j,
                0.66114093 + 0.63164795j,
                0.64216788 + 0.64408527j,
                0.64083294 + 0.64792088j,
                0.6426059 + 0.65721866j,
                0.65127667 + 0.6693043j,
                0.64600835 + 0.68206702j,
                0.64201973 + 0.69240139j,
                0.63005618 + 0.70156604j,
                0.62493878 + 0.71293328j,
                0.63767207 + 0.71056997j,
                0.63744179 + 0.70486697j,
                0.64587089 + 0.69808462j,
                0.63909668 + 0.69082451j,
                0.64330159 + 0.68250018j,
                0.63464604 + 0.68888145j,
                0.62206823 + 0.70323509j,
                0.63991742 + 0.68542492j,
                0.6407161 + 0.68096328j,
                0.64231074 + 0.63093317j,
                0.68184858 + 0.61236309j,
                0.64975165 + 0.64633579j,
                0.62221087 + 0.67364908j,
                0.61869135 + 0.6786168j,
                0.61518713 + 0.69393699j,
                0.62558659 + 0.70295781j,
                0.62911769 + 0.70931058j,
                0.61475593 + 0.7311059j,
                0.59891595 + 0.74207498j,
                0.59714534 + 0.74298854j,
                0.6094539 + 0.73365856j,
                0.6142308 + 0.72040665j,
                0.62545701 + 0.71109305j,
                0.6249134 + 0.70090258j,
                0.64215679 + 0.68103574j,
                0.64289989 + 0.68170053j,
                0.63513016 + 0.68994668j,
                0.6589871 + 0.66945822j,
                0.67637484 + 0.65221818j,
                0.62878708 + 0.64595041j,
                0.66278383 + 0.6359361j,
                0.63927736 + 0.65127302j,
                0.62560969 + 0.67180777j,
                0.61813759 + 0.68316203j,
                0.60822895 + 0.70634477j,
                0.61913992 + 0.71381508j,
                0.62577007 + 0.71837007j,
                0.61418232 + 0.73695136j,
                0.60239077 + 0.74183236j,
                0.59788155 + 0.7511156j,
                0.60968238 + 0.73565489j,
                0.61486908 + 0.72053788j,
                0.63171507 + 0.70274674j,
                0.63956894 + 0.6874794j,
                0.65360317 + 0.6755892j,
                0.65151908 + 0.67754824j,
                0.64612916 + 0.68353672j,
                0.67192222 + 0.66238374j,
                0.67825473 + 0.66060121j,
                0.61999369 + 0.65642251j,
                0.64370469 + 0.65532714j,
                0.63832759 + 0.64897221j,
                0.62741077 + 0.66490695j,
                0.62525582 + 0.66807305j,
                0.60996569 + 0.6932607j,
                0.6228049 + 0.69594443j,
                0.62909265 + 0.70243554j,
                0.61719054 + 0.71955458j,
                0.61254668 + 0.71711797j,
                0.59385792 + 0.74276725j,
                0.60872812 + 0.721969j,
                0.60648405 + 0.71465645j,
                0.62440846 + 0.69660544j,
                0.63298797 + 0.68379446j,
                0.65141226 + 0.66697613j,
                0.65676056 + 0.66277912j,
                0.65133942 + 0.66772418j,
                0.68244267 + 0.64135943j,
                0.68447764 + 0.64756898j,
                0.59700378 + 0.69555812j,
                0.61326527 + 0.69011426j,
                0.63200713 + 0.66274255j,
                0.62392797 + 0.67631471j,
                0.63127352 + 0.67002698j,
                0.60577583 + 0.70045221j,
                0.62700912 + 0.69377619j,
                0.63026294 + 0.70164601j,
                0.61594615 + 0.7193101j,
                0.61285637 + 0.71612174j,
                0.58607768 + 0.75175806j,
                0.59155388 + 0.73313082j,
                0.57420146 + 0.74389625j,
                0.59187411 + 0.72844184j,
                0.59788267 + 0.71881963j,
                0.62651726 + 0.68924997j,
                0.63344168 + 0.68632373j,
                0.6311815 + 0.69235053j,
                0.65016939 + 0.67325376j,
                0.65854084 + 0.68231319j,
                0.61449226 + 0.69896238j,
                0.61317937 + 0.70487552j,
                0.64034165 + 0.66621509j,
                0.64312052 + 0.66502932j,
                0.64310655 + 0.66495986j,
                0.6213278 + 0.69055312j,
                0.63179382 + 0.68348563j,
                0.63994442 + 0.68540751j,
                0.63584861 + 0.69093988j,
                0.64130405 + 0.68052459j,
                0.60836499 + 0.72294731j,
                0.60406353 + 0.71723132j,
                0.59705487 + 0.71755922j,
                0.61513169 + 0.70233456j,
                0.61341404 + 0.7055794j,
                0.63540293 + 0.68113309j,
                0.64710003 + 0.6798608j,
                0.64718757 + 0.68393482j,
                0.66761985 + 0.66478289j,
                0.67789192 + 0.67271356j,
                0.5685101 + 0.71543434j,
                0.57241852 + 0.7219637j,
                0.61948901 + 0.669555j,
                0.61902173 + 0.67009714j,
                0.62408525 + 0.66552939j,
                0.6241032 + 0.67921299j,
                0.64204549 + 0.66698012j,
                0.65009144 + 0.6712098j,
                0.65021698 + 0.67446807j,
                0.66024396 + 0.65630759j,
                0.6100991 + 0.70886831j,
                0.60226204 + 0.71148318j,
                0.59577588 + 0.71424338j,
                0.60673079 + 0.70118505j,
                0.6061938 + 0.70073874j,
                0.62951847 + 0.67512093j,
                0.64234846 + 0.67329282j,
                0.63988727 + 0.68207514j,
                0.66876973 + 0.65946413j,
                0.69262507 + 0.65137772j,
                0.56920027 + 0.72357955j,
                0.56488941 + 0.73393103j,
                0.61018954 + 0.68122989j,
                0.61576066 + 0.67794544j,
                0.62083196 + 0.67234449j,
                0.62314609 + 0.681524j,
                0.64385574 + 0.664315j,
                0.66354557 + 0.65394672j,
                0.67007787 + 0.65543034j,
                0.68134121 + 0.64351793j,
                0.63217095 + 0.69810997j,
                0.61474084 + 0.70793884j,
                0.61901563 + 0.70259904j,
                0.62254827 + 0.69766439j,
                0.60986011 + 0.70782753j,
                0.63105836 + 0.68197441j,
                0.63968162 + 0.68231397j,
                0.64057199 + 0.68223903j,
                0.67311161 + 0.65349981j,
                0.70836446 + 0.635471j,
                0.53276034 + 0.76415634j,
                0.52561474 + 0.77618771j,
                0.57968115 + 0.71434735j,
                0.59380896 + 0.70454722j,
                0.60029569 + 0.69826706j,
                0.61082813 + 0.69516563j,
                0.63167873 + 0.67951783j,
                0.64954674 + 0.66977342j,
                0.66320704 + 0.66483853j,
                0.67249995 + 0.65200294j,
                0.6271045 + 0.7036974j,
                0.59532068 + 0.71905161j,
                0.58944194 + 0.7178904j,
                0.59160665 + 0.71313749j,
                0.58305747 + 0.71426438j,
                0.61136243 + 0.6818462j,
                0.62666938 + 0.66831424j,
                0.63362592 + 0.66171788j,
                0.66262694 + 0.62893128j,
                0.71737688 + 0.59668611j,
                0.5534531 + 0.75213496j,
                0.53279935 + 0.77528032j,
                0.57819369 + 0.72004203j,
                0.59228083 + 0.70818124j,
                0.59299442 + 0.70437577j,
                0.59264371 + 0.70715214j,
                0.6148803 + 0.69184373j,
                0.63056751 + 0.68216329j,
                0.64994233 + 0.6723401j,
                0.66726632 + 0.65151374j,
                0.64291642 + 0.68737258j,
                0.6178342 + 0.69778246j,
                0.61367624 + 0.69940439j,
                0.63086633 + 0.68298846j,
                0.62211872 + 0.68452284j,
                0.63463865 + 0.6659139j,
                0.64649174 + 0.64919637j,
                0.65415705 + 0.64269432j,
                0.66598408 + 0.62162097j,
                0.70922358 + 0.59881236j,
                0.59393224 + 0.73035691j,
                0.57194535 + 0.74566988j,
                0.60273106 + 0.71031378j,
                0.6119958 + 0.6974223j,
                0.60241279 + 0.69970776j,
                0.60824367 + 0.69694763j,
                0.61905717 + 0.68601386j,
                0.6194278 + 0.68675918j,
                0.62692694 + 0.68391269j,
                0.64664354 + 0.66100524j,
                0.62699627 + 0.68508096j,
                0.59356878 + 0.70928625j,
                0.59716315 + 0.70476541j,
                0.5974541 + 0.70185621j,
                0.59952408 + 0.69827279j,
                0.62153371 + 0.6690546j,
                0.64674855 + 0.63718985j,
                0.64808744 + 0.63873207j,
                0.65692186 + 0.62221642j,
                0.71066722 + 0.58260275j,
                0.61795883 + 0.69865207j,
                0.59453763 + 0.71782932j,
                0.62216846 + 0.68735902j,
                0.62457047 + 0.68186719j,
                0.6110587 + 0.69159259j,
                0.61263211 + 0.70108624j,
                0.62222267 + 0.6937708j,
                0.61373259 + 0.70157417j,
                0.61382672 + 0.70173763j,
                0.62108197 + 0.68750485j,
                0.61041473 + 0.70386164j,
                0.57736532 + 0.73212484j,
                0.57949327 + 0.72513993j,
                0.57803479 + 0.72243437j,
                0.57951881 + 0.71460174j,
                0.60825142 + 0.67887711j,
                0.63062424 + 0.65236315j,
                0.64061757 + 0.64887369j,
                0.6362831 + 0.64289355j,
                0.69440132 + 0.59142308j,
                0.63989919 + 0.66722005j,
                0.62088314 + 0.68945986j,
                0.63196635 + 0.67602258j,
                0.62833712 + 0.67409162j,
                0.61490193 + 0.6878096j,
                0.60171143 + 0.71130114j,
                0.59441063 + 0.71494141j,
                0.59182363 + 0.71791734j,
                0.60346564 + 0.71260244j,
                0.61148812 + 0.69730047j,
                0.61280386 + 0.70295179j,
                0.59791434 + 0.72252157j,
                0.60581365 + 0.70687299j,
                0.620001 + 0.69333516j,
                0.6366478 + 0.67666965j,
                0.6518266 + 0.65559753j,
                0.67126986 + 0.62500843j,
                0.6786309 + 0.62261954j,
                0.67824297 + 0.61339877j,
                0.71936725 + 0.56869245j,
                0.6206617 + 0.67555895j,
                0.61046639 + 0.69203555j,
                0.61685333 + 0.68278248j,
                0.6051204 + 0.69297215j,
                0.59626479 + 0.7036593j,
                0.58295118 + 0.7264538j,
                0.57258818 + 0.73723488j,
                0.57159263 + 0.74008082j,
                0.5803952 + 0.74059973j,
                0.57955081 + 0.73287034j,
                0.58656868 + 0.73238879j,
                0.58370242 + 0.73806412j,
                0.58376012 + 0.72878212j,
                0.59856311 + 0.71369738j,
                0.62226501 + 0.68538249j,
                0.63812124 + 0.66234027j,
                0.66328396 + 0.62210987j,
                0.67599961 + 0.6142984j,
                0.67470009 + 0.60556375j,
                0.70856211 + 0.56492085j,
                0.68696016 + 0.63393116j,
                0.65817565 + 0.66207473j,
                0.65063339 + 0.66106318j,
                0.64774688 + 0.66777628j,
                0.62629939 + 0.68933366j,
                0.59109014 + 0.72604526j,
                0.56572359 + 0.74568006j,
                0.55973692 + 0.75155626j,
                0.55796493 + 0.76024029j,
                0.55540519 + 0.75726715j,
                0.57981577 + 0.74639635j,
                0.56849056 + 0.75520616j,
                0.57940993 + 0.73589411j,
                0.59920246 + 0.7189598j,
                0.62052145 + 0.69965194j,
                0.64254622 + 0.66977469j,
                0.67270084 + 0.62200842j,
                0.6929185 + 0.60543036j,
                0.67756796 + 0.60476081j,
                0.70851811 + 0.56655157j,
                0.67796662 + 0.6397934j,
                0.65550862 + 0.66171991j,
                0.65450687 + 0.65389889j,
                0.64719062 + 0.66262334j,
                0.62904975 + 0.6836154j,
                0.58652258 + 0.73129151j,
                0.55178614 + 0.76069353j,
                0.53831149 + 0.77177785j,
                0.54085306 + 0.77248838j,
                0.52646661 + 0.77749377j,
                0.54815393 + 0.76855854j,
                0.54046631 + 0.77419499j,
                0.53853128 + 0.7637145j,
                0.56915145 + 0.73296819j,
                0.60546757 + 0.70256218j,
                0.63221499 + 0.66825021j,
                0.67383451 + 0.60737576j,
                0.70257932 + 0.58577018j,
                0.68737665 + 0.58586006j,
                0.71839694 + 0.5494397j,
            ]
        )
        self._coherence_co_registered = np.array(
            [
                6.890150768921443625e-01,
                6.813099549429065815e-01,
                6.413272152393104664e-01,
                6.388162874590437301e-01,
                6.606078229651015654e-01,
                7.053613535726532824e-01,
                7.557470180253905712e-01,
                7.749097160950433327e-01,
                8.045153655222718747e-01,
                8.110056623092611883e-01,
                8.294899903341274028e-01,
                8.613267353410809513e-01,
                8.548951018133510438e-01,
                8.389917921369574039e-01,
                7.915683980916011775e-01,
                7.555137065376131833e-01,
                7.431244621165141728e-01,
                7.404512765596485968e-01,
                7.452761983828372072e-01,
                7.204152383902785450e-01,
                6.276612987718177550e-01,
                6.451994195879136029e-01,
                6.339675414797982800e-01,
                6.315541623289541162e-01,
                6.499657205496154333e-01,
                6.974320529629955967e-01,
                7.737781294669727750e-01,
                7.869410710897857264e-01,
                8.104993381519502993e-01,
                8.141914780234652538e-01,
                8.349948407668797978e-01,
                8.559795580693445594e-01,
                8.514004598908684329e-01,
                8.387749558393438054e-01,
                7.933438658255601572e-01,
                7.683108731663783608e-01,
                7.400254157780741249e-01,
                7.439768465936639208e-01,
                7.315578533295291619e-01,
                7.192128913213011732e-01,
                6.915970433111282567e-01,
                7.067484303371927012e-01,
                6.834588183443029985e-01,
                6.737574947771456380e-01,
                6.845352069275768558e-01,
                7.112197528053020301e-01,
                7.882811436073537958e-01,
                7.971335022164800499e-01,
                8.197964702645088586e-01,
                8.231009695412968563e-01,
                8.481278854893146146e-01,
                8.605362833473699791e-01,
                8.476550662344519704e-01,
                8.455681510504994280e-01,
                7.967819878225415042e-01,
                7.771411137661973223e-01,
                7.550651941551763668e-01,
                7.567560650336079275e-01,
                7.420707999775667529e-01,
                7.412804716686223205e-01,
                6.780091861582212553e-01,
                7.110575518941215645e-01,
                6.906125242124490082e-01,
                6.799955655053432357e-01,
                6.885732208000709953e-01,
                7.127134601137812275e-01,
                7.835627784763233850e-01,
                8.025270249537362899e-01,
                8.196695909087755583e-01,
                8.061767291063837160e-01,
                8.277028887832399429e-01,
                8.405275635157757330e-01,
                8.255524974061504428e-01,
                8.282994743026984574e-01,
                7.815616038654726871e-01,
                7.688882215790888708e-01,
                7.534497305700804670e-01,
                7.700846855350479414e-01,
                7.620853863927687932e-01,
                7.567476234740208030e-01,
                6.855236169375050759e-01,
                7.262209165262188959e-01,
                7.131414341930285561e-01,
                7.000521681715033973e-01,
                7.048341197615469733e-01,
                7.347967689346424081e-01,
                7.945641851105704756e-01,
                8.113413049052474735e-01,
                8.290417995667648254e-01,
                8.217074995166869789e-01,
                8.390283325088215838e-01,
                8.542470898598301110e-01,
                8.430778946407336827e-01,
                8.480602340589314947e-01,
                8.093750853459420469e-01,
                7.969985688986394035e-01,
                7.920691099073897679e-01,
                8.015987179208766689e-01,
                7.990835491150537484e-01,
                7.940944152843886217e-01,
                6.543165196850484477e-01,
                7.196266313079420218e-01,
                7.195373963679145835e-01,
                7.249674887923227562e-01,
                7.269447362447984951e-01,
                7.649070368901798034e-01,
                8.180046697473493111e-01,
                8.386911726182685323e-01,
                8.623813085251738064e-01,
                8.583246534686460594e-01,
                8.553253056339104043e-01,
                8.506547119933574042e-01,
                8.306153040749012506e-01,
                8.333177333200552095e-01,
                8.029397200573514803e-01,
                7.890077950765236325e-01,
                7.914797367280965723e-01,
                7.967743332623244967e-01,
                8.032026465797615922e-01,
                8.068482961486663774e-01,
                6.550879652277017406e-01,
                7.172989739092979766e-01,
                6.956305059729104290e-01,
                7.206257941634254260e-01,
                7.306073055218790246e-01,
                7.745552022971823325e-01,
                8.228033494142881210e-01,
                8.482302770118916868e-01,
                8.713476770186382447e-01,
                8.623733253616007177e-01,
                8.747335844110585290e-01,
                8.533519444273713894e-01,
                8.309216508023470338e-01,
                8.263591311822069407e-01,
                8.028096965680558972e-01,
                8.007265769122821064e-01,
                7.981047606900681934e-01,
                8.021908464099178904e-01,
                8.138262940795504274e-01,
                8.300255080574110433e-01,
                6.563765835664991943e-01,
                7.137719080624091994e-01,
                6.827573328353307991e-01,
                6.988423459714731001e-01,
                7.000662346535574398e-01,
                7.359126606938777293e-01,
                7.786632396256146782e-01,
                8.088033698104034608e-01,
                8.290496074873142662e-01,
                8.153787772560894265e-01,
                8.424009194632067210e-01,
                8.165313316023051771e-01,
                7.973585862837081484e-01,
                7.955017302644794563e-01,
                7.795661817528172222e-01,
                7.761979174597638531e-01,
                7.790059376699893789e-01,
                7.808099611454942801e-01,
                7.961352412778571752e-01,
                8.191999292577263336e-01,
                7.096668242446885211e-01,
                7.294271528388013293e-01,
                7.030810615523883644e-01,
                7.215564184147554849e-01,
                7.240559513900227673e-01,
                7.471649954177117525e-01,
                7.823863615512548497e-01,
                8.074284235117683561e-01,
                8.240459633313632626e-01,
                8.114838333730541864e-01,
                8.490744375232909258e-01,
                8.070658033426539868e-01,
                7.971593061650449341e-01,
                7.973345042389786697e-01,
                7.819211949382715021e-01,
                7.675526541062113184e-01,
                7.772240306931678111e-01,
                7.890760198531963088e-01,
                7.880639856541843402e-01,
                8.300288346304804943e-01,
                7.703667647046603673e-01,
                7.769349012213193628e-01,
                7.391259571063907297e-01,
                7.420552520946782638e-01,
                7.433719332812815939e-01,
                7.543865458727717632e-01,
                7.604402163649468527e-01,
                7.828223844855408675e-01,
                7.890412005911568993e-01,
                7.748154029583017577e-01,
                8.113696716532305953e-01,
                7.873028291626568143e-01,
                7.731098394185677014e-01,
                7.788539286284785756e-01,
                7.821520717819521185e-01,
                7.673246436747842569e-01,
                7.936727045913603007e-01,
                8.065535371266500109e-01,
                8.107841286276681325e-01,
                8.553345691427048925e-01,
                7.123562866113355430e-01,
                7.311767981517929282e-01,
                6.968494052502525182e-01,
                6.965986720320622716e-01,
                6.988204802390486359e-01,
                7.339210402119418220e-01,
                7.396924128900170814e-01,
                7.696306828414658519e-01,
                7.777910693871733505e-01,
                7.603614482853772172e-01,
                7.795400480848243552e-01,
                7.695095393162579844e-01,
                7.625803013535422670e-01,
                7.585043970774041355e-01,
                7.594395595021348200e-01,
                7.440697780720100241e-01,
                7.720098948333726785e-01,
                7.870764365180057398e-01,
                8.029442241254024504e-01,
                8.438471203278954391e-01,
                7.421037619427488519e-01,
                7.518617480707880940e-01,
                7.094130597352866774e-01,
                7.135001179983601061e-01,
                7.132721100999307451e-01,
                7.417214405202002814e-01,
                7.406108274074063580e-01,
                7.671645829305069331e-01,
                7.835045391019264116e-01,
                7.880723482109009970e-01,
                8.069379680393637955e-01,
                7.927391539974485424e-01,
                7.871374393160127658e-01,
                7.857101672060321507e-01,
                7.883095519517995253e-01,
                7.650907195337818267e-01,
                7.886944547256506954e-01,
                7.880660225225719628e-01,
                7.975079063146230940e-01,
                8.483643521567901802e-01,
                7.866045273561911300e-01,
                7.971045571679573616e-01,
                7.334024111415501368e-01,
                7.356743091070924168e-01,
                7.366202795302834172e-01,
                7.511129811153961500e-01,
                7.512797405949003249e-01,
                7.729259998104981433e-01,
                7.869716926931703549e-01,
                7.829358213720728488e-01,
                8.065295543911974452e-01,
                7.756855902657118218e-01,
                7.599583598660077932e-01,
                7.545255342681899124e-01,
                7.469895697891014708e-01,
                7.199177422470817156e-01,
                7.258240672405695815e-01,
                7.260602360057546445e-01,
                7.131614106477855985e-01,
                7.893057322778250784e-01,
                7.843920918085890426e-01,
                8.030787834435172412e-01,
                7.413736948089135748e-01,
                7.362600003570131113e-01,
                7.309272385135654471e-01,
                7.351833564354223194e-01,
                7.376405934307518342e-01,
                7.582674024766266063e-01,
                7.750581502823128410e-01,
                7.703779960023864337e-01,
                8.032111827804401250e-01,
                7.701543611756551666e-01,
                7.696299821011504116e-01,
                7.699825535480792071e-01,
                7.621846309575871503e-01,
                7.371803239889976878e-01,
                7.305113334954945747e-01,
                7.363461963886122064e-01,
                7.096439149745269459e-01,
                7.793875606743420059e-01,
                8.269380739099239097e-01,
                8.180679353413033983e-01,
                7.881783172965209916e-01,
                7.701749906214311325e-01,
                7.567264619124727254e-01,
                7.602990052196947346e-01,
                7.433920695744815621e-01,
                7.521678111648060217e-01,
                7.516284120512525257e-01,
                7.425897974523281153e-01,
                7.604538844162741507e-01,
                7.467943278362237924e-01,
                7.448206108178887508e-01,
                7.381856067739949179e-01,
                7.448317994991252577e-01,
                7.147706884799237548e-01,
                7.020642522961593190e-01,
                7.112762450378037338e-01,
                6.868568054075043783e-01,
                7.413115061443628084e-01,
                8.035586541216797052e-01,
                7.958936664077983503e-01,
                7.731318399739454117e-01,
                7.595953094528993255e-01,
                7.557720893125330353e-01,
                7.841813231818883789e-01,
                7.722173669626469783e-01,
                7.787967978944968506e-01,
                7.670228667430564196e-01,
                7.504694426550470032e-01,
                7.737356509378864322e-01,
                7.733064560517175501e-01,
                7.602654217008871784e-01,
                7.481750972264058497e-01,
                7.407671899662974235e-01,
                7.052758553733032842e-01,
                6.986730778543587261e-01,
                7.135175985155957079e-01,
                6.783258621489028917e-01,
                7.101857999050721348e-01,
                7.715186675246542558e-01,
                7.781539749576585896e-01,
                7.666664641926890233e-01,
                7.470847320834806959e-01,
                7.505430390925744710e-01,
                7.836962218693586113e-01,
                7.616621997250633269e-01,
                7.681536153511234755e-01,
                7.694068002533384076e-01,
                7.532265687104071628e-01,
                7.750947706073957333e-01,
                7.923724254155882774e-01,
                7.727471386298389033e-01,
                7.671766957898323858e-01,
                7.762583231920481275e-01,
                7.582584952535023071e-01,
                7.403200986423007501e-01,
                7.493305808052234118e-01,
                7.199505678705208078e-01,
                7.346321374792218473e-01,
                7.469617876619455421e-01,
                7.611189926916047677e-01,
                7.494196345374790624e-01,
                7.447390542120707613e-01,
                7.515233957091814743e-01,
                7.890111898256015888e-01,
                7.805704013406566943e-01,
                7.907021509696731121e-01,
                7.981848187090473390e-01,
                7.809284044062120289e-01,
                7.968375855798603968e-01,
                8.043475237772845787e-01,
                7.851183386111350027e-01,
                7.745492136967500052e-01,
                7.683710465550197544e-01,
                7.457910802237749381e-01,
                7.190952046108177731e-01,
                7.284769668487128813e-01,
                6.971919495038108039e-01,
                7.014855954823873141e-01,
                8.018070959559834288e-01,
                7.986233945253577993e-01,
                7.777132989683309683e-01,
                7.823988818183139626e-01,
                7.853898882671850323e-01,
                8.085389453112842295e-01,
                7.916796214379335783e-01,
                7.991902246427010637e-01,
                8.061271317487017640e-01,
                7.914177399146627989e-01,
                8.141413465851320419e-01,
                8.128756468760239828e-01,
                7.899140959863839573e-01,
                7.815149735710436030e-01,
                7.923203466321924182e-01,
                7.666109374976470825e-01,
                7.365606411164338230e-01,
                7.465493571838217601e-01,
                6.964132536130569484e-01,
                6.978227214424578273e-01,
                7.914424564363702341e-01,
                7.904407032000572153e-01,
                7.692616690924820588e-01,
                7.676088879581141056e-01,
                7.756121579305443881e-01,
                8.098579784981940755e-01,
                8.008451123081092859e-01,
                8.076498544490723352e-01,
                8.070728319852513710e-01,
                7.904015049899483225e-01,
                8.059137641051579148e-01,
                8.048153443055784395e-01,
                7.799713089613796724e-01,
                7.519827926163045184e-01,
                7.627553826524964276e-01,
                7.371394345719617380e-01,
                7.057302432929823954e-01,
                7.288039363787109925e-01,
                6.820656919345665647e-01,
                6.904275676396469663e-01,
            ]
        )
        self._coherence_bin_edges = np.array(
            [
                0.0,
                0.02,
                0.04,
                0.06,
                0.08,
                0.1,
                0.12,
                0.14,
                0.16,
                0.18,
                0.2,
                0.22,
                0.24,
                0.26,
                0.28,
                0.3,
                0.32,
                0.34,
                0.36,
                0.38,
                0.4,
                0.42,
                0.44,
                0.46,
                0.48,
                0.5,
                0.52,
                0.54,
                0.56,
                0.58,
                0.6,
                0.62,
                0.64,
                0.66,
                0.68,
                0.7,
                0.72,
                0.74,
                0.76,
                0.78,
                0.8,
                0.82,
                0.84,
                0.86,
                0.88,
                0.9,
                0.92,
                0.94,
                0.96,
                0.98,
                1.0,
            ]
        )
        self._az_hist = np.array(
            [
                [1, 0, 0, 3, 3, 0],
                [3, 1, 0, 1, 1, 1],
                [2, 1, 0, 1, 0, 4],
                [0, 2, 1, 4, 0, 1],
                [2, 0, 1, 1, 1, 1],
                [0, 2, 2, 0, 2, 1],
                [2, 5, 1, 0, 2, 1],
                [3, 0, 0, 0, 1, 2],
                [1, 0, 2, 3, 0, 3],
                [2, 0, 0, 2, 2, 0],
                [1, 2, 0, 1, 1, 0],
                [0, 0, 1, 1, 0, 2],
                [3, 1, 4, 3, 1, 0],
                [4, 2, 1, 1, 1, 2],
                [3, 3, 0, 0, 2, 4],
                [1, 4, 2, 0, 4, 0],
                [0, 4, 6, 3, 0, 2],
                [2, 0, 0, 1, 1, 0],
                [2, 2, 2, 2, 3, 0],
                [2, 1, 0, 0, 1, 1],
                [1, 2, 1, 3, 3, 1],
                [2, 2, 2, 0, 1, 0],
                [1, 1, 4, 1, 2, 0],
                [0, 1, 2, 3, 0, 3],
                [0, 2, 1, 1, 1, 1],
                [0, 1, 0, 1, 0, 2],
                [1, 1, 0, 0, 1, 0],
                [3, 1, 3, 1, 0, 2],
                [2, 2, 3, 2, 2, 3],
                [3, 0, 1, 0, 1, 0],
                [2, 0, 0, 0, 0, 1],
                [1, 1, 0, 4, 1, 0],
                [1, 2, 0, 2, 1, 1],
                [2, 3, 2, 0, 1, 0],
                [2, 4, 2, 0, 1, 0],
                [2, 3, 1, 2, 2, 2],
                [2, 5, 1, 3, 1, 0],
                [4, 1, 3, 0, 2, 4],
                [3, 1, 2, 1, 1, 1],
                [2, 2, 1, 1, 2, 2],
                [2, 0, 2, 0, 2, 2],
                [1, 1, 1, 0, 2, 1],
                [2, 3, 1, 4, 3, 0],
                [3, 1, 0, 1, 0, 0],
                [1, 2, 3, 0, 2, 2],
                [0, 1, 0, 1, 2, 3],
                [0, 3, 0, 0, 0, 0],
                [2, 1, 1, 1, 0, 2],
                [1, 1, 0, 0, 0, 1],
                [0, 2, 0, 1, 0, 1],
            ],
            dtype=np.int64,
        )
        self._rng_hist = np.array(
            [
                [2, 0, 1, 0, 0, 0, 3, 0, 1],
                [0, 3, 0, 0, 0, 1, 2, 1, 0],
                [2, 2, 1, 0, 0, 1, 0, 1, 1],
                [4, 1, 1, 0, 0, 2, 0, 0, 0],
                [2, 0, 0, 1, 0, 1, 0, 1, 1],
                [2, 0, 0, 1, 1, 1, 1, 1, 0],
                [0, 1, 5, 1, 1, 1, 1, 0, 1],
                [1, 2, 1, 1, 1, 0, 0, 0, 0],
                [1, 1, 1, 0, 2, 0, 1, 2, 1],
                [1, 1, 1, 0, 0, 2, 0, 1, 0],
                [0, 0, 2, 0, 0, 0, 3, 0, 0],
                [0, 1, 1, 0, 1, 0, 0, 1, 0],
                [2, 4, 0, 0, 3, 0, 1, 0, 2],
                [3, 1, 0, 0, 1, 1, 3, 2, 0],
                [1, 1, 2, 1, 1, 5, 0, 0, 1],
                [2, 3, 0, 3, 1, 0, 0, 0, 2],
                [1, 1, 4, 2, 2, 2, 1, 1, 1],
                [1, 2, 0, 0, 1, 0, 0, 0, 0],
                [4, 0, 0, 2, 1, 0, 2, 2, 0],
                [1, 0, 0, 0, 2, 0, 1, 0, 1],
                [1, 1, 1, 3, 0, 2, 0, 1, 2],
                [1, 3, 0, 0, 0, 1, 0, 0, 2],
                [2, 0, 2, 2, 1, 1, 1, 0, 0],
                [0, 5, 1, 1, 1, 0, 0, 0, 1],
                [0, 1, 0, 1, 1, 1, 1, 1, 0],
                [0, 1, 0, 1, 1, 0, 0, 1, 0],
                [0, 2, 0, 0, 0, 0, 1, 0, 0],
                [1, 1, 2, 0, 1, 3, 1, 0, 1],
                [3, 0, 1, 2, 3, 1, 2, 2, 0],
                [0, 0, 2, 1, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 0, 1, 1],
                [0, 1, 0, 1, 0, 1, 1, 1, 2],
                [1, 1, 0, 2, 0, 0, 1, 0, 2],
                [1, 1, 0, 1, 1, 0, 3, 1, 0],
                [0, 3, 0, 0, 1, 1, 2, 0, 2],
                [3, 2, 2, 1, 3, 0, 0, 0, 1],
                [2, 1, 0, 1, 2, 2, 1, 3, 0],
                [3, 2, 1, 2, 0, 0, 2, 3, 1],
                [1, 1, 2, 1, 0, 1, 0, 2, 1],
                [1, 0, 1, 2, 0, 0, 0, 3, 3],
                [1, 0, 0, 1, 1, 1, 0, 2, 2],
                [0, 1, 0, 2, 1, 2, 0, 0, 0],
                [1, 0, 2, 1, 2, 1, 0, 4, 2],
                [0, 2, 0, 0, 1, 0, 2, 0, 0],
                [1, 4, 0, 1, 1, 1, 1, 0, 1],
                [5, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 1, 0, 1, 0, 1, 0, 0, 0],
                [1, 0, 1, 0, 1, 0, 1, 1, 2],
                [0, 1, 0, 0, 0, 1, 0, 0, 1],
                [1, 1, 1, 0, 0, 0, 1, 0, 0],
            ],
            dtype=np.int64,
        )

    def test_coherence_computation_interferogram(self) -> None:
        """Testing coherence_computation_core on test array"""
        interferogram = self._test_array_re + 1j * self._test_array_im
        out = coherence_computation_interferogram_core(data=interferogram, kernel_size=self._kernel_size)
        np.testing.assert_allclose(out.compressed(), self._coherence, atol=self._tolerance, rtol=0)

    def test_coherence_computation_co_registered(self) -> None:
        """Testing coherence_computation_core on test array"""
        data_1 = self._test_array_re + 1j * self._test_array_im
        data_2 = self._test_array_im + 1j * self._test_array_re
        out = coherence_computation_co_registered_core(data_1=data_1, data_2=data_2, kernel_size=self._kernel_size)
        np.testing.assert_allclose(abs(out.compressed()), self._coherence_co_registered, atol=self._tolerance, rtol=0)

    def test_coherence_2d_histograms(self) -> None:
        """Testing coherence_2d_histogram_computation_core on test array"""
        config = InterferometricConfig(azimuth_blocks_number=6, range_blocks_number=9, coherence_bins_number=50)
        out = coherence_2d_histogram_computation_core(coherence=self._test_array_re, config=config)
        self.assertIsInstance(out, InterferometricCoherence2DHistograms)
        np.testing.assert_array_equal(out.azimuth_histogram, self._az_hist)
        np.testing.assert_array_equal(out.range_histogram, self._rng_hist)
        np.testing.assert_allclose(out.coherence_bin_edges, self._coherence_bin_edges, atol=self._tolerance, rtol=0)

    def test_coherence_histograms_to_netcdf(self) -> None:
        """Testing coherence_histograms_to_netcdf"""
        data = InterferometricCoherenceOutput(
            channel_name="1",
            swath="S1",
            burst=0,
            polarization=SARPolarization.HV,
            coherence=self._coherence,
            coherence_histograms=InterferometricCoherence2DHistograms(
                coherence_bin_edges=self._coherence_bin_edges,
                azimuth_histogram=self._az_hist,
                range_histogram=self._rng_hist,
            ),
        )
        with TemporaryDirectory() as temp_dir:
            out = Path(temp_dir).joinpath("output")
            out.mkdir()
            out_file = out.joinpath("coherence_histograms_" + data.swath + "_" + data.polarization.name + ".nc")
            coherence_histograms_to_netcdf(data=data, output_dir=out)
            # results checking
            self.assertTrue(out_file.exists())
            self.assertTrue(out_file.is_file())
            root = Dataset(out_file, "r", format="NETCDF4")
            self.assertEqual(root.swath, data.swath)
            self.assertEqual(root.channel, data.channel_name)
            self.assertEqual(root.burst, data.burst)
            self.assertEqual(root.polarization, data.polarization.name)
            np.testing.assert_array_equal(
                root.variables["coherence_bins"][:].data, data.coherence_histograms.coherence_bin_edges[:-1]
            )
            np.testing.assert_array_equal(
                root.variables["azimuth_histogram"][:].data, data.coherence_histograms.azimuth_histogram
            )
            np.testing.assert_array_equal(
                root.variables["range_histogram"][:].data, data.coherence_histograms.range_histogram
            )
            root.close()


if __name__ == "__main__":
    unittest.main()
